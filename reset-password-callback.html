<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to Recipe AI...</title>
</head>
<body>
    <p>Redirecting to Recipe AI app...</p>
    <script>
        // Extract tokens from URL - check both hash fragment and query parameters
        const hash = window.location.hash.substring(1); // Remove #
        const searchParams = new URLSearchParams(window.location.search);
        const hashParams = new URLSearchParams(hash);
        
        // Try hash fragment first (PKCE flow), then query parameters
        let accessToken = hashParams.get('access_token') || searchParams.get('access_token');
        let refreshToken = hashParams.get('refresh_token') || searchParams.get('refresh_token');
        let type = hashParams.get('type') || searchParams.get('type');
        
        // Also check for token parameter (alternative format)
        if (!accessToken) {
            accessToken = hashParams.get('token') || searchParams.get('token');
        }
        
        // Redirect if we have tokens
        if (accessToken) {
            // Build app URL with tokens
            let appUrl = 'com.recipeai.app://reset-password';
            
            if (accessToken && refreshToken) {
                // Use hash fragment format (PKCE flow)
                appUrl += `#access_token=${encodeURIComponent(accessToken)}&refresh_token=${encodeURIComponent(refreshToken)}`;
            } else if (accessToken) {
                // Fallback: just access_token
                appUrl += `#access_token=${encodeURIComponent(accessToken)}`;
            }
            
            // Redirect to app
            window.location.href = appUrl;
            
            // Fallback: Show message if app doesn't open
            setTimeout(() => {
                document.body.innerHTML = '<p>If the app did not open, please open Recipe AI manually and try again.</p>';
            }, 2000);
        } else {
            // No tokens found - show error
            document.body.innerHTML = '<p>Invalid reset link. Please request a new password reset email.</p>';
        }
    </script>
</body>
</html>
